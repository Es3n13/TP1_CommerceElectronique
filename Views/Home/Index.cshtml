@{
    ViewData["Title"] = "Accueil";
    Layout = "_Layout";
}

@{
    var restaurants = (IList<BoutiqueElegance.Models.Restaurant>)(ViewBag.Restaurants ?? new List<BoutiqueElegance.Models.Restaurant>());
    var allTags = (IList<BoutiqueElegance.Models.Tag>)(ViewBag.AllTags ?? new List<BoutiqueElegance.Models.Tag>());
    var selectedTag = (string?)ViewBag.SelectedTag;
    var search = (string?)ViewBag.Search;
}

<section class="filter-bar mb-4">
    <form method="get" asp-controller="Home" asp-action="Index" class="filter-form d-flex flex-wrap gap-2 align-items-center">
        <div class="input-group search-group">
            <span class="input-group-text">
                <i class="bi bi-search"></i>
            </span>
            <input type="text"
                   name="search"
                   value="@search"
                   placeholder="Rechercher un restaurant"
                   class="form-control search-input" />
        </div>

        <div class="input-group tag-group">
            <span class="input-group-text">
                <i class="bi bi-filter-square"></i>
            </span>
            <select name="selectedTag" class="form-select tag-select">
                <option value="">Toutes les cuisines</option>
                @foreach (var tag in allTags)
                {
                    <option value="@tag.Name" selected="@(tag.Name == selectedTag ? "selected" : null)">
                        @tag.Name
                    </option>
                }
            </select>
        </div>

        <button type="submit" class="btn btn-primary filter-button">
            <i class="bi bi-funnel-fill me-1"></i>Filtrer
        </button>
    </form>
</section>

<section>
    <h2 class="mb-3">Restaurants populaires</h2>

    @if (restaurants.Count == 0)
    {
        <p class="text-muted">
            <i class="bi bi-emoji-frown me-1"></i>Aucun restaurant trouvé.
        </p>
    }
    else
    {
        <div class="products">
            @foreach (var restaurant in restaurants)
            {
                <div class="product-card">
                    <img src="@restaurant.ImageUrl" alt="@restaurant.Name" />
                    <h3 class="mt-2">
                        <i class="bi bi-shop-window me-1 text-primary"></i>@restaurant.Name
                    </h3>
                    <p>@restaurant.Description</p>
                    <p class="tags text-muted mb-2">
                        Cuisine :
                        @{
                            var cuisines = new List<string>();
                            foreach (var rt in restaurant.RestaurantTags)
                            {
                                cuisines.Add(rt.Tag.Name);
                            }
                            @string.Join(", ", cuisines)
                        }
                    </p>
                    <a asp-controller="Restaurants"
                       asp-action="Details"
                       asp-route-id="@restaurant.Id"
                       class="btn btn-outline-dark">
                        <i class="bi bi-journal-text me-1"></i>Voir le menu
                    </a>
                </div>
            }
        </div>
    }
</section>


