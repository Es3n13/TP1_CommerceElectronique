@{
    ViewData["Title"] = "Mes commandes";
    Layout = "_Layout";
}

<div class="container">
    <h2 class="page-title">
        <i class="bi bi-bag-check" style="margin-right:6px;"></i>
        Mes commandes
    </h2>

    @{
        var orders = (IList<BoutiqueElegance.Models.Order>)ViewBag.Orders;
    }

    @if (!orders.Any())
    {
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="bi bi-clipboard-x" style="font-size:2.5rem; color:#bbb;"></i>
            </div>
            <h3>Aucune commande</h3>
            <p>Vous n'avez pas encore de commande. Commencez à commander dès maintenant!</p>
            <a asp-controller="Home" asp-action="Index" class="btn btn-primary">
                <i class="bi bi-egg-fried" style="margin-right:4px;"></i>
                Découvrir nos plats
            </a>
        </div>
    }
    else
    {
        <div class="orders-grid">
            @foreach (var order in orders)
            {
                <div class="order-card">
                    <!-- En-tête -->
                    <div class="order-header">
                        <div class="order-info">
                            <h3 class="order-number">
                                <i class="bi bi-receipt" style="margin-right:4px;"></i>
                                Commande #@order.Id
                            </h3>
                            <p class="order-date">
                                <i class="bi bi-calendar-event" style="margin-right:4px;"></i>
                                @order.CreatedAt.ToLocalTime().ToString("dd/MM/yyyy - HH:mm")
                            </p>
                        </div>
                        <div class="order-status">
                            <span class="status-badge @GetStatusClass(order.Status)">
                                <i class="bi bi-circle-fill" style="margin-right:4px; font-size:0.5rem;"></i>
                                @GetStatusLabel(order.Status)
                            </span>
                        </div>
                    </div>

                    <!-- Contenu -->
                    <div class="order-body">
                        <div class="order-total">
                            <span class="total-label">Total:</span>
                            <span class="total-amount">
                                <i class="bi bi-currency-dollar" style="margin-right:4px;"></i>
                                @order.TotalAmount.ToString("0.00") $
                            </span>
                        </div>
                    </div>

                    <div class="summary-divider"></div>

                    <!-- Footer -->
                    <div class="order-footer">
                        <a asp-controller="Orders"
                           asp-action="Details"
                           asp-route-id="@order.Id"
                           class="btn btn-view-details">
                            <i class="bi bi-eye" style="margin-right:4px;"></i>
                            Voir les détails
                            <span class="arrow">→</span>
                        </a>
                    </div>
                </div>
            }
        </div>
    }
</div>

@functions {
    private string GetStatusClass(string status)
    {
        return status?.ToLower() switch
        {
            "pending" => "status-pending",
            "paid" => "status-paid",
            "failed" => "status-failed",
            _ => "status-pending"
        };
    }

    private string GetStatusLabel(string status)
    {
        return status?.ToLower() switch
        {
            "pending" => "En attente",
            "paid" => "Payée",
            "failed" => "Échouée",
            _ => status ?? "Inconnue"
        };
    }
}

