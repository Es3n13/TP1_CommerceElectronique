@{
    ViewData["Title"] = "Détails de la commande (restaurant)";
    Layout = "_Layout";
}

@{
    var order = (BoutiqueElegance.Models.Order?)ViewBag.Order;
}

<div class="container">
    @if (order == null)
    {
        <div class="error-state">
            <div class="error-icon"></div>
            <h3>Commande introuvable</h3>
            <p>La commande que vous recherchez n'existe pas ou n'est pas liée à votre restaurant.</p>
            <a asp-controller="Sales" asp-action="Index" class="btn btn-primary">
                Retour aux commandes du restaurant
            </a>
        </div>
    }
    else
    {
        <!-- En-tête -->
        <div class="order-details-header">
            <div>
                <h2 class="page-title">
                    Commande #@order.Id – @order.Restaurant?.Name
                </h2>
            </div>
        </div>

        <div class="order-details-wrapper">
            <div class="order-details-main">
                <!-- Info commande -->
                <div class="info-card">
                    <h3 class="card-title">Informations de la commande</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Date de commande</span>
                            <p class="info-value">
                                @order.CreatedAt.ToLocalTime().ToString("dd/MM/yyyy - HH:mm")
                            </p>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Statut</span>
                            <p class="info-value">
                                <span class="status-badge @GetStatusClass(order.Status)">
                                    @GetStatusLabel(order.Status)
                                </span>
                            </p>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Client</span>
                            <p class="info-value">
                                @order.Client?.FullName
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Items -->
                <div class="items-card">
                    <h3 class="card-title">Articles de la commande</h3>
                    <div class="order-items-list">
                        @foreach (var item in order.Items)
                        {
                            <div class="order-item-row">
                                <div class="item-details">
                                    <h4 class="item-name">@item.Plat.Name</h4>
                                    @if (!string.IsNullOrEmpty(item.Plat.Description))
                                    {
                                        <p class="item-description">@item.Plat.Description</p>
                                    }
                                </div>
                                <div class="item-quantity">
                                    <span class="qty-label">Quantité:</span>
                                    <span class="qty-value">@item.Quantity</span>
                                </div>
                                <div class="item-price">
                                    <span class="price-label">Prix unitaire:</span>
                                    <span class="price-value">@item.UnitPrice $</span>
                                </div>
                                <div class="item-subtotal">
                                    <span class="subtotal-label">Sous-total:</span>
                                    <span class="subtotal-value">
                                        @(item.UnitPrice* item.Quantity) $
                                    </span>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Sidebar sommaire -->
            <div class="order-details-sidebar">
                <div class="summary-card">
                    <div class="summary-divider"></div>
                    <div class="summary-total">
                        <span class="total-label">Total:</span>
                        <span class="total-amount">
                            @order.TotalAmount $
                        </span>
                    </div>
                </div>
            </div>

            <div class="header-content">
                <a asp-controller="Sales" asp-action="Index" class="btn btn-primary">
                    ← Retour aux commandes du restaurant
                </a>
            </div>
        </div>
    }
</div>

@functions {
    private string GetStatusClass(string status)
    {
        return status?.ToLower() switch
        {
            "pending" => "status-pending",
            "paid" => "status-paid",
            "failed" => "status-failed",
            _ => "status-pending"
        };
    }

    private string GetStatusLabel(string status)
    {
        return status?.ToLower() switch
        {
            "pending" => "En attente",
            "paid" => "Payée",
            "failed" => "Échouée",
            _ => status ?? "Inconnue"
        };
    }
}
