@page
@model BoutiqueElegance.Pages.Checkout.IndexModel
@{
    ViewData["Title"] = "Paiement";
}

<div class="container">
    <!-- Titre de la page -->
    <div class="checkout-header">
        <h1 class="page-title">Finaliser votre commande</h1>
    </div>

    <!-- Checkout Layout principal -->
    <div class="checkout-wrapper">
        <!-- Résumé de la commande -->
        <div class="checkout-summary-section">
            <div class="summary-card">
                <h2 class="section-title">Résumé de votre commande</h2>
                <!-- Items de la commande -->
                <div class="order-items-summary">
                    @foreach (var item in Model.Cart.Items)
                    {
                        <div class="summary-item">
                            <div class="item-info">
                                <h4 class="item-name">@item.Plat.Name</h4>
                                <p class="item-detail">Quantité: <strong>@item.Quantity</strong></p>
                            </div>
                            <div class="item-total">
                                <span class="item-amount">@(item.UnitPrice* item.Quantity) $</span>
                            </div>
                        </div>
                    }
                    <!-- Divider -->
                    <div class="summary-divider"></div>
                    <!-- Total final -->
                    <div class="final-total">
                        <span class="total-label">Total à payer:</span>
                        <span class="total-amount">@Model.Total.ToString("0.00") $</span>
                    </div>
                    <!-- Retour au panier -->
                    <a href="@Url.Page("/Cart/Index")" class="link-back">← Retour au panier</a>
                </div>
            </div>
        </div>

        <!-- Formulaire de paiement -->
        <div class="checkout-payment-section">
            <div class="payment-card">
                <h2 class="section-title">Informations de paiement</h2>
                <form method="post" class="payment-form">
                    <!-- Nom sur la carte -->
                    <div class="form-group">
                        <label for="cardHolder" class="form-label">Nom sur la carte</label>
                        <input type="text"
                               id="cardHolder"
                               asp-for="CardHolderName"
                               class="form-input"
                               required />
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label for="email" class="form-label">Adresse courriel</label>
                        <input type="email"
                               id="email"
                               asp-for="Email"
                               class="form-input"
                               required />
                    </div>

                    <!-- Numéro de la carte -->
                    <div class="form-group">
                        <label for="cardNumber" class="form-label">Numéro de carte</label>
                        <input type="text"
                               id="cardNumber"
                               class="form-input"
                               placeholder="4242 4242 4242 4242"
                               maxlength="19"
                               oninput="formatCardNumber(this)"
                               required />
                    </div>

                    <!-- Expiration et CVC -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="expiry" class="form-label">Expiration</label>
                            <input type="text"
                                   id="expiry"
                                   class="form-input"
                                   placeholder="MM/AA"
                                   maxlength="5"
                                   oninput="formatExpiry(this)"
                                   required />
                        </div>
                        <div class="form-group">
                            <label for="cvc" class="form-label">CVC</label>
                            <input type="text"
                                   id="cvc"
                                   class="form-input"
                                   placeholder="123"
                                   maxlength="4"
                                   oninput="this.value = this.value.replace(/[^0-9]/g, '');"
                                   required />
                        </div>
                    </div>

                    <!-- Code postal -->
                    <div class="form-group">
                        <label for="postalCode" class="form-label">Code postal</label>
                        <input type="text"
                               id="postalCode"
                               class="form-input"
                               placeholder="G0L 1B0"
                               required />
                    </div>

                    <!-- Bouton payer -->
                    <button type="submit" class="btn-pay">
                        Payer @Model.Total.ToString("0.00") $
                        <span class="btn-arrow">→</span>
                    </button>
                </form>

                <!-- Info Sécurité -->
                <div class="security-info">
                    <span class="security-icon"></span>
                    <p>Vos données sont sécurisées par <strong>Stripe</strong></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Format d'affichage pour le paiement -->
<script>
    function formatCardNumber(input) {
        let value = input.value.replace(/\s/g, '');
        let formattedValue = value.replace(/(\d{4})/g, '$1 ').trim();
        input.value = formattedValue;
    }

    function formatExpiry(input) {
        let value = input.value.replace(/\D/g, '');
        if (value.length >= 2) {
            value = value.substring(0, 2) + '/' + value.substring(2, 4);
        }
        input.value = value;
    }
</script>


