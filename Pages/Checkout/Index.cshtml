@page
@model BoutiqueElegance.Pages.Checkout.IndexModel

@{
    ViewData["Title"] = "Paiement";
}

<script>
    const stripePublicKey = '@Model.StripePublicKey';
</script>

<!-- Charger Stripe.js -->
<script src="https://js.stripe.com/v3/"></script>

<!-- Mon script -->
<script src="~/js/stripe-payment.js"></script>

<div class="container">
    <!-- Titre de la page -->
    <div class="checkout-header">
        <h1 class="page-title">Finaliser votre commande</h1>
    </div>

    <!-- Checkout Layout principal -->
    <div class="checkout-wrapper">
        <!-- Résumé de la commande -->
        <div class="checkout-summary-section">
            <div class="summary-card">
                <h2 class="section-title">Résumé de votre commande</h2>

                <!-- Items de la commande -->
                <div class="order-items-summary">
                    @foreach (var item in Model.Cart.Items)
                    {
                        <div class="summary-item">
                            <div class="item-info">
                                <h4 class="item-name">@item.Plat.Name</h4>
                                <p class="item-detail">Quantité: <strong>@item.Quantity</strong></p>
                            </div>
                            <div class="item-total">
                                <span class="item-amount">@(item.UnitPrice* item.Quantity) $</span>
                            </div>
                        </div>
                    }

                <!-- Divider -->
                <div class="summary-divider"></div>

                <!-- Total final -->
                <div class="final-total">
                    <span class="total-label">Total à payer:</span>
                    <span class="total-amount">@Model.Total.ToString("0.00") $</span>
                </div>

                <!-- Retour au panier -->
                <a href="@Url.Page("/Cart/Index")" class="link-back">← Retour au panier</a>
            </div>
        </div>

            <!-- Formulaire de paiement modernisé -->
            <div class="checkout-payment-section">
                <div class="payment-card">
                    <h2 class="section-title">💳 Informations de paiement</h2>
                    <form id="payment-form" class="payment-form">

                        <!-- Nom sur la carte -->
                        <div class="form-group">
                            <label for="cardHolder" class="form-label">Nom sur la carte</label>
                            <input type="text"
                                   id="cardHolder"
                                   asp-for="CardHolderName"
                                   class="form-input"
                                   placeholder="Jean Dupont"
                                   required />
                        </div>

                        <!-- Email -->
                        <div class="form-group">
                            <label for="email" class="form-label">Adresse courriel</label>
                            <input type="email"
                                   id="email"
                                   asp-for="Email"
                                   class="form-input"
                                   placeholder="jean@exemple.com"
                                   required />
                        </div>

                        <!-- Stripe Elements (remplace les champs carte/expiration/CVC) -->
                        <div class="form-group">
                            <label class="form-label">Numéro de carte</label>
                            <div id="card-element" class="form-input"></div>
                            <div id="card-errors" role="alert" style="color: #fa755a; margin-top: 8px;"></div>
                        </div>

                        <!-- Code postal (optionnel, Stripe peut le demander) -->
                        <div class="form-group">
                            <label for="postalCode" class="form-label">Code postal</label>
                            <input type="text"
                                   id="postalCode"
                                   class="form-input"
                                   placeholder="G0L 1B0"
                                   required />
                        </div>

                        <!-- Bouton payer -->
                        <button type="submit" class="btn-pay" id="submit-btn">
                            Payer @Model.Total.ToString("0.00") $
                            <span class="btn-arrow">→</span>
                        </button>
                    </form>

                    <!-- Info Sécurité -->
                    <div class="security-info">
                        <span class="security-icon">🔒</span>
                        <p>Vos données sont sécurisées par <strong>Stripe</strong></p>
                    </div>
                </div>
            </div>

            <!-- Passer le ClientSecret au script JS -->
            <script>
                const clientSecret = '@Model.ClientSecret';
                const total = @Model.Total.ToString("0.00");
            </script>


<!-- Format d'affichage pour le paiement -->
<script>
    function formatCardNumber(input) {
        let value = input.value.replace(/\s/g, '');
        let formattedValue = value.replace(/(\d{4})/g, '$1 ').trim();
        input.value = formattedValue;
    }

    function formatExpiry(input) {
        let value = input.value.replace(/\D/g, '');
        if (value.length >= 2) {
            value = value.substring(0, 2) + '/' + value.substring(2, 4);
        }
        input.value = value;
    }
</script>


